name: Gradle (Build + Test + Jacoco Report) CI

on:
  push:
    branches: [ '*' ]
  pull_request:
    branches: [ '*' ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: set up JDK 15
      uses: actions/setup-java@v2
      with:
        java-version: '15'
        distribution: 'adopt'
    - name: Make Gradlew Executable
      run: chmod +x gradlew
    - name: Gradle Build/Test Action
      run : ./gradlew clean build
    - name: Generate Report
      run: ./gradlew aggregateReports
    - name: jacoco-badge-generator
      uses: cicirello/jacoco-badge-generator@v2.4.1
      with:
        jacoco-csv-file: >
          build/reports/jacoco/test/jacocoTestReport.csv
    - name: Commit the badge (if it changed)
      run: |
          if [[ `git status --porcelain` ]]; then
                  git config --global user.name 'Github Badge'
                  git config --global user.email 'jacocoBadgeGenerator@example.com'
                  git add -A
                  git commit -m "Autogenerated JaCoCo coverage badge"
                  git push
          fi


     
